<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Usage - Netatmo GeoPy</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Usage";
    var mkdocs_page_input_path = "usage.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Netatmo GeoPy</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Usage</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#pre-requisites">Pre-requisites</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#features">Features</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#schedule-a-periodic-job-to-record-cws-data-for-a-region">Schedule a periodic job to record CWS data for a region</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#assemble-cws-snapshots-into-a-single-time-series-geo-data-frame">Assemble CWS snapshots into a single time-series geo-data frame</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../api/">API</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../contributing/">Contributing</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../authors/">Authors</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../history/">History</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Netatmo GeoPy</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Usage</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/martibosch/netatmo-geopy/edit/master/docs/usage.md"> Edit on netatmo-geopy</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="usage">Usage</h1>
<h2 id="pre-requisites">Pre-requisites</h2>
<p>In order to access the data from Netatmo citizen weather stations (CWS), you need a Netatmo username, password, client ID and client secret. You can obtain the former credentials following the steps below:</p>
<ol>
<li>Create an Netatmo account at <a href="https://auth.netatmo.com/access/signup">auth.netatmo.com/access/signup</a>. The entered email address and password will respectively be the username and password used in netatmo-geopy.</li>
<li>From your account, navigate to <a href="https://dev.netatmo.com/apps">dev.netatmo.com/apps/</a> and click "Create" to create an app. This only serves to obtain a client ID and secret key, so you do not need to enter any specific information in "app name" and "description".</li>
<li>Once the app is created, save the generated "client ID" and "client secret" which will appear in the form below (entitled "App Technical Parameters"), which will be used in netatmo-geopy.</li>
</ol>
<h2 id="features">Features</h2>
<p>First import netatmo-geopy as in:</p>
<pre><code class="language-python">import netatmo_geopy as nat
</code></pre>
<p>You can then use netatmo-geopy to get the CWS temperature measurements for a region of interest as in:</p>
<pre><code class="language-python"># latitude/longitude bounds of the region of interest
lon_sw, lat_sw, lon_ne, lat_ne = 6.5175, 46.5012, 6.7870, 46.6058

# init the CWS recorder
cws_recorder = nat.CWSRecorder(
    lon_sw,
    lat_sw,
    lon_ne,
    lat_ne,
    username=&quot;&lt;your-netatmo-username&gt;&quot;,
    password=&quot;&lt;your-netatmo-password&gt;&quot;,
    client_id=&quot;&lt;your-netatmo-client-id&gt;&quot;,
    client_secret=&quot;&lt;your-netatmo-client-secret&gt;&quot;,
)
</code></pre>
<p>Alternatively, instead of passing the Netatmo credentials to the initalization of <code>CWSRecorder</code>, you can also set them as the <code>NETATMO_USERNAME</code>, <code>NETATMO_PASSWORD</code>, <code>NETATMO_CLIENT_ID</code>, and <code>NETATMO_CLIENT_SECRET</code> environment variables, then netatmo-geopy will use them automatically when required. In order to use more concise code snippets, the remainder of this page assumes that the Netatmo credientials are provided using the environment variables.</p>
<p>Then, the current snapshot of CWS measurements in the region can be obtained as in:</p>
<pre><code class="language-python">gdf = cws_recorder.get_snapshot_gdf()
gdf.head()
</code></pre>
<div>
    <style scoped>
     .dataframe tbody tr th:only-of-type {
         vertical-align: middle;
     }

     .dataframe tbody tr th {
         vertical-align: top;
     }

     .dataframe thead th {
         text-align: right;
     }
    </style>
    <table border="1" class="dataframe">
        <thead>
            <tr style="text-align: right;">
                <th></th>
                <th>2022-02-12T19:13</th>
                <th>geometry</th>
            </tr>
            <tr>
                <th>station_id</th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <th>02:00:00:01:5e:e0</th>
                <td>6.6</td>
                <td>POINT (6.82799 46.47089)</td>
            </tr>
            <tr>
                <th>02:00:00:22:c0:c0</th>
                <td>4.9</td>
                <td>POINT (6.82904 46.47005)</td>
            </tr>
            <tr>
                <th>02:00:00:2f:0b:16</th>
                <td>3.5</td>
                <td>POINT (6.82516 46.47294)</td>
            </tr>
            <tr>
                <th>02:00:00:59:00:2a</th>
                <td>3.8</td>
                <td>POINT (6.84547 46.46779)</td>
            </tr>
            <tr>
                <th>02:00:00:52:ed:5a</th>
                <td>3.8</td>
                <td>POINT (6.87359 46.47067)</td>
            </tr>
        </tbody>
    </table>
</div>

<p>You can also use the <code>plot_snapshot</code> to plot the data on a map:</p>
<pre><code class="language-python">nat.plot_snapshot(gdf)
</code></pre>
<p><img alt="lausanne-snapshot" src="../figures/lausanne.png" /></p>
<h3 id="schedule-a-periodic-job-to-record-cws-data-for-a-region">Schedule a periodic job to record CWS data for a region</h3>
<p>It is possible to use netatmo-geopy to set up a periodic job to record CWS measurements. To that end, you need to provide the <code>time_unit</code> argument to the initialization of <code>CWSRecorder</code>, as in:</p>
<pre><code class="language-python">snapshot_data_dir = &quot;data/lausanne&quot;
cws_recorder = nat.CWSRecorder(
    lon_sw, lat_sw, lon_ne, lat_ne, dst_dir=snapshot_data_dir, time_unit=&quot;hour&quot;
)
</code></pre>
<p>which will dump an hourly snapshot of CWS measurements to the directory specified with the <code>dst_dir</code> argument. The <code>time_unit</code> argument can be combined with the <code>interval</code>, <code>at</code> and <code>until</code> arguments, e.g., the following task will record the CWS measurements of the region at the 30th minute of every three hours for the next 24 hours:</p>
<pre><code class="language-python">from datetime import datetime, timedelta

cws_recorder = nat.CWSRecorder(
    lon_sw,
    lat_sw,
    lon_ne,
    lat_ne,
    dst_dir=snapshot_data_dir,
    time_unit=&quot;hours&quot;,
    interval=3
    at=&quot;:30&quot;,
    until=datetime.now() + timedelta(hours=24),
)
</code></pre>
<p>See <a href="https://schedule.readthedocs.io/">the documentation of schedule</a> for more examples on scheduling periodic jobs.</p>
<h3 id="assemble-cws-snapshots-into-a-single-time-series-geo-data-frame">Assemble CWS snapshots into a single time-series geo-data frame</h3>
<p>After a time series of snapshots have been dumped to a directory, the <code>CWSDataset</code> class can be used to assemble the data into a single geo-data frame, i.e., the <code>temperature_gdf</code> attribute:</p>
<pre><code class="language-python">cws_dataset = nat.CWSDataset(snapshot_data_dir=snapshot_data_dir)
cws_dataset.temperature_gdf.head()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>2022-02-06 09:30:00</th>
      <th>2022-02-06 12:30:00</th>
      <th>2022-02-06 15:30:00</th>
      <th>2022-02-06 18:30:00</th>
      <th>2022-02-06 21:30:00</th>
      <th>2022-02-07 00:30:00</th>
      <th>2022-02-07 03:30:00</th>
      <th>2022-02-07 06:30:00</th>
      <th>geometry</th>
    </tr>
    <tr>
      <th>station_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>02:00:00:01:5e:e0</th>
      <td>1.542567</td>
      <td>4.815597</td>
      <td>0.550991</td>
      <td>0.948516</td>
      <td>2.600634</td>
      <td>0.312831</td>
      <td>3.088689</td>
      <td>3.442664</td>
      <td>POINT (6.82799 46.47089)</td>
    </tr>
    <tr>
      <th>02:00:00:22:c0:c0</th>
      <td>4.093453</td>
      <td>2.291656</td>
      <td>0.258319</td>
      <td>3.346670</td>
      <td>4.571841</td>
      <td>2.299931</td>
      <td>0.447544</td>
      <td>4.558038</td>
      <td>POINT (6.82904 46.47005)</td>
    </tr>
    <tr>
      <th>02:00:00:2f:0b:16</th>
      <td>1.588176</td>
      <td>4.521104</td>
      <td>3.060942</td>
      <td>1.931824</td>
      <td>3.027879</td>
      <td>2.567090</td>
      <td>1.326534</td>
      <td>0.043705</td>
      <td>POINT (6.82516 46.47294)</td>
    </tr>
    <tr>
      <th>02:00:00:59:00:2a</th>
      <td>0.452659</td>
      <td>2.443335</td>
      <td>2.270666</td>
      <td>0.867035</td>
      <td>3.965786</td>
      <td>2.200247</td>
      <td>3.443507</td>
      <td>1.314949</td>
      <td>POINT (6.84547 46.46779)</td>
    </tr>
    <tr>
      <th>02:00:00:52:ed:5a</th>
      <td>1.022992</td>
      <td>1.795367</td>
      <td>1.099024</td>
      <td>2.775641</td>
      <td>1.663362</td>
      <td>1.033040</td>
      <td>1.875658</td>
      <td>1.031009</td>
      <td>POINT (6.87359 46.47067)</td>
    </tr>
  </tbody>
</table>
</div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../api/" class="btn btn-neutral float-right" title="API">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../installation/" class="btn btn-neutral" title="Installation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../installation/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../api/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
